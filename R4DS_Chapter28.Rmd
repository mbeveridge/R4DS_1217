---
title: "Chapter28"
output:
  github_document: default
  html_notebook: default
---

```{r}
library("tidyverse")
library("modelr")
library("lubridate")
```


## 28. "Graphics for communication" [Chapter 22 hardcopy]
### 28.2.1 Exercises

Q1.
Create one plot on the fuel economy data with customised `title`, `subtitle`, `caption`, `x`, `y`, and `colour` labels

A1.
Combining the examples from s28.2 R4DS book (which corrects/removes `paste()` code that is in the hardcopy) :

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```


-----------

Q2.
The `geom_smooth()` is somewhat misleading because the `hwy` for large engines is skewed upwards due to the inclusion of lightweight sports cars with big engines. Use your modelling tools to fit and display a better model

A2.
Starting from the code in A2 and making 2 ADDitions, then revisualising :

```{r}
ggplot(mpg, aes(displ, hwy, colour = class)) +      # ADD: `colour = class` to get multiple lines
  geom_point(aes(colour = class)) +
  geom_smooth(method = "lm", se = FALSE) +          # ADD: `method = "lm"` to get straight lines
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

Based on [https://jrnold.github.io/r4ds-exercise-solutions/graphics-for-communication.html#label] (but that answer had relabelled x&y axes the wrong way around) :

```{r}
mod <- lm(hwy ~ class, data = mpg)             # model based on fuel economy for Class (Car type)
mpg %>%
  add_residuals(mod) %>%
  ggplot(aes(displ, resid)) +                  # `resid` is default column name for residuals
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Highway MPG for Cars After Subtracting Mean MPG of their Class",
    caption = "Data from fueleconomy.gov",
    x = "Engine displacement (L)",
    y = "Highway fuel economy, relative to Class (mpg)"
  )
```

[Not sure what this is intended to show. I assume it's that after removing effects of all the coloured linear models, we're left with this one that's fairly 'flat' (and so there really is a linear relationship for each `Car type`)? Otherwise, I assume it's that the coloured models shouldn't be straight lines?]


-----------

Q3.
Take an exploratory graphic that you’ve created in the last month, and add informative titles to make it easier for others to understand.

A3.


-----------

## 28. "Graphics for communication" [Chapter 22 hardcopy]
### 28.3.1 Exercises

Q1. Use `geom_text()` with infinite positions to place text at the four corners of the plot

A1.
```{r}
label_bottomleft <- tibble(displ = -Inf, hwy = -Inf, label = "Bottom left")
label_topleft <- tibble(displ = -Inf, hwy = Inf, label = "Top left")
label_topright <- tibble(displ = Inf, hwy = Inf, label = "Top right")
label_bottomright <- tibble(displ = Inf, hwy = -Inf, label = "Bottom right")

# (Based on plot used near end of s28.3.) This places the text ok, but it's mostly off-screen :
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_text(aes(label = label), data = label_bottomleft) +
  geom_text(aes(label = label), data = label_topleft) +
  geom_text(aes(label = label), data = label_topright) +
  geom_text(aes(label = label), data = label_bottomright)

# This is longer, but justifies the text, so that it's all readable :
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_text(aes(label = label), data = label_bottomleft, hjust = "left", vjust = "bottom") +
  geom_text(aes(label = label), data = label_topleft, hjust = "left", vjust = "top") +
  geom_text(aes(label = label), data = label_topright, hjust = "right", vjust = "top") +
  geom_text(aes(label = label), data = label_bottomright, hjust = "right", vjust = "bottom")
```

[https://jrnold.github.io/r4ds-exercise-solutions/graphics-for-communication.html#annotations] shows a way to simplify this, by creating a table in a `tribble()`, and then using "a single `geom_text` call instead of four different `geom_text` calls with four different `data` arguments, and four different values of `hjust` and `vjust` arguments"


-----------

Q2.
Read the documentation for `annotate()`. How can you use it to add a text label to a plot without having to create a tibble?

A2.
```{r}
?ggplot2::annotate

# "This function adds geoms to a plot, but unlike typical a geom function, the properties of the geoms are not mapped from variables of a data frame, but are instead passed in as vectors. This is useful for adding small annotations (such as text labels) or if you have your data in vectors, and for some reason don't want to put them in a data frame" -- Help
```

Based on [https://jrnold.github.io/r4ds-exercise-solutions/graphics-for-communication.html#annotations] : "With `annotate` you use what would be aesthetic mappings directly as arguments" :
```{r}
ggplot(mpg, aes(displ, hwy)) +                           # same as before
  geom_point() +                                         # same as before
  annotate("text", x = Inf, y = Inf,                     # instead of `geom_text()`
           label = "Top right again", vjust = "top", hjust = "right"
           )
```


-----------

Q3.
How do labels with `geom_text()` interact with faceting? How can you add a label to a single facet? How can you put a different label in each facet? (Hint: think about the underlying data.)

A3.

-----------

Q4. What arguments to `geom_label()` control the appearance of the background box?

A4.

-----------

Q5.
What are the four arguments to `arrow()`? How do they work? Create a series of plots that demonstrate the most important options

A5.


-----------

## 28. "Graphics for communication" [Chapter 22 hardcopy]
### 28.4.4 Exercises

Q1.
Why doesn’t the following code override the default scale?

```{r}
ggplot(df, aes(x, y)) +
  geom_hex() +
  scale_colour_gradient(low = "white", high = "red") +
  coord_fixed()
```

A1.

-----------

Q2. What is the first argument to every scale? How does it compare to `labs()`?

A2.

-----------

Q3.
Change the display of the presidential terms by:

1. Combining the two variants shown above
2. Improving the display of the y axis
3. Labelling each term with the name of the president
4. Adding informative plot labels
5. Placing breaks every 4 years (this is trickier than it seems!)

A3.

-----------

Q4.
Use `override.aes` to make the legend on the following plot easier to see

```{r}
ggplot(diamonds, aes(carat, price)) +
  geom_point(aes(colour = cut), alpha = 1/20)
```

A4.




